# <img src="https://github.com/hhumbertoAv/FLOC/assets/6061953/39adf1cb-08eb-4d51-a1fe-5fd26966350e" width="40"/> EcoFloc: Energy Measuring System Tool for Linux





## Acknowledgments

<p align="center">
  <img src="https://github.com/user-attachments/assets/ce919194-b05e-48d3-a75c-90806b022335" width="45%"/>
</p>


**EcoFloc** was developed by the R&D laboratory of **Technopôle Domolandes**[^1], with support from **Université de Pau et des Pays de l'Adour** and **Université de Toulouse**. These institutions play a key role in advancing research and innovation, contributing to technological progress and regional development in France.  








## <img src="https://github.com/user-attachments/assets/d3265b45-19ab-4805-a6a9-2ad332353ee3" width="40"/> Description

**EcoFloc** is a versatile tool that measures the energy consumption of processes based on the load they generate on **CPU**, **GPU**, **RAM**, **storage devices (SD)**, and **network interface controllers (NIC)**. It supports independent per-component measurement, interval-based sampling, and long-term monitoring, persisting data even if applications restart. **EcoFloc** can analyze existing applications or launch new ones from the boot process to track their energy usage from the start.  


### Power calculation


**EcoFloc** estimates energy consumption per hardware component based on the load generated by running processes. It uses data from **GNU/Linux kernel** interfaces when available; otherwise, it relies on predefined or user-customized hardware specs.  

This release includes pre-defined formulas for the five hardware components[^3]. Future updates will add more methods and kernel-level interfaces like RAPL[^2], giving users flexible measurement options.  


### Limitations

Like any software-based energy measurement tool, **EcoFloc** provides approximations and should not be considered **absolutely** precise.  






## <img src="https://github.com/user-attachments/assets/4ec4916a-7223-467f-8195-f2c725b9703e" width="40"/> Dependencies  

**EcoFloc** requires an Arch-based or Debian-based GNU/Linux distribution with Linux kernel 5.12 or higher.  

To collect hardware metrics, install the following packages:  

- **CPU:** `msr-tools`  
- **GPU:** `nvidia-smi` (yes, this version only supports NVIDIA GPUs :-) )  
- **RAM:** `glibc` (for `iconv`) and `perf`  
- **NIC:** `nethogs` **≥ 0.8.7**  

```bash  
# Arch-based distributions
pacman -S msr-tools glibc linux-tools nethogs nvidia-smi  # Use 'linux-zen-tools' instead if running the Zen kernel  

# Debian-based distributions
apt-get update
apt-get install msr-tools libc-bin linux-tools-common linux-tools-$(uname -r) nethogs nvidia-smi  

# If nethogs ≥ 0.8.7 is unavailable, check:
# https://launchpad.net/ubuntu/kinetic/arm64/nethogs/0.8.7-1
```







## <img src="https://github.com/user-attachments/assets/aaafd2c7-c056-4358-88a3-650e09a50b1f" width="45"/> Configuration  


**EcoFloc** needs the power profile of each hardware component, along with some custom information, such as the network interface to monitor for NIC analysis. While **EcoFloc** attempts to detect these values automatically, please update the **_settings.conf** file in each hardware folder. You can find the required values in the hardware datasheets, usually available on the manufacturer’s website.  






## <img src="https://github.com/user-attachments/assets/9386b9c8-fe7c-4ed9-8dc3-1253b3d9e500" width="40"/> Installation

**Automated Installation**  

To install **EcoFloc**, run the following command as root:  

```bash  
/bin/bash ecofloc_installer.sh  # Requires Python 3  
```

At the end of the installation, a summary will display any potential issues. If you believe these issues are not valid and still want to test **EcoFloc**, proceed with the manual compilation steps below.  

**Manual Compilation and Installation** 

1. Navigate to the project root  

```bash  
cd /path/to/ecofloc  
```

2. Clean previous builds  

```bash  
make clean  
```

3. Compile and install  

```bash  
make  
make install  
```

4. Uninstall if needed  

```bash  
make uninstall  
```





## <img src="https://github.com/user-attachments/assets/eea63aa7-9c82-4da2-8d9a-e834b594fe3e" width="40"/> Running EcoFloc  

To use **EcoFloc**, execute the `ecofloc` command as root with the following options:  

### **Which component to analyze**  

1. **Hardware** - The first parameter to specify is the hardware component to analyze. For example:  

```bash  
ecofloc --cpu ...  
``` 

### **What to analyze**  

**EcoFloc** can analyze an existing process or application, or launch an application to monitor its execution, including its boot process.  

2. **Process ID (PID) (`-p`)** – Analyze an already running process by specifying its PID.  
3. **Application Name (`-n`)** – Monitor all PIDs associated with an existing application.  
4. **Launch Application (`-l`)** – Start an application and analyze only its main PID.  
5. **Launch Application (`-L`)** – Start an application and monitor all PIDs associated with its name. *(If an instance is already running, it will be included in the analysis.)*  


### **Time parameters**

Then, specify the measuring interval and total analysis time:  

6. **Total Analysis Time (`-t`)** – Defines the measurement duration. A negative value enables continuous analysis, which can be stopped with `Ctrl+C` to display results.  
7. **Measurement Interval (`-i`)** – Sets how often **EcoFloc** collects load and power data. *Smaller values may increase CPU usage*.  

### **Extra Parameters**  

8. **Dynamic Mode (`-d`)** – Allows **EcoFloc** to track applications that may be closed and reopened during analysis.  
9. **Export Mode (`-f`)** – Saves measurement results to a CSV file at the specified path. If set to **default**, **EcoFloc** will use the path defined in `settings.conf` inside each component folder. The file includes, for each interval: measurement time, PID, average power, and energy consumed.  
10. **Verbose Mode (`-v`)** – Shows warnings, especially when `-l` or `-L` is used.  


### Execution Commands  

Run **EcoFloc** using the following format:  

```bash  
ecofloc --cpu -p or -n [PID or App Name] or -l or -L [App Name] -i [interval] -t [duration] -d -v -f [path]  
ecofloc --sd -p or -n [PID or App Name] or -l or -L [App Name] -i [interval] -t [duration] -d -v -f [path]  
ecofloc --nic -p or -n [PID or App Name] or -l or -L [App Name] -i [interval] -t [duration] -d -v -f [path]  
ecofloc --ram -p or -n [PID or App Name] or -l or -L [App Name] -i [interval] -t [duration] -d -v -f [path]  
ecofloc --gpu -p or -n [PID or App Name] or -l or -L [App Name] -i [interval] -t [duration] -d -v -f [path]  
```  



## <img src="https://github.com/user-attachments/assets/1dadab89-96cb-4567-8551-8ede96235caa" width="40"/> Outputs  

After the specified timeout or when you press `Ctrl+C`, **EcoFloc** will display:  

- **Average Power (Watts):** Mean power consumption over the total analysis time.  
- **Energy Consumption (Joules):** Total energy used during the analysis.  










## <img src="https://github.com/user-attachments/assets/6d243035-b154-4d8f-9abb-d47597d0e04b" width="40"/> Usage Examples  

### Example 1: Analyze a Specific Process  

To check the CPU energy usage of a process with PID **20300**, sampling every **1000ms** for **10 seconds**, run:  

```bash  
ecofloc --cpu -p 20300 -i 1000 -t 10 -f /home/user/  
```  

You'll see something like this:  

```console
/*****************************  
/ECOFLOC_RAM_PID_20300  
*****************************/  
Average Power (CPU): 0.47 Watts  
Total CPU Energy (CPU): 4.72 Joules  
*****************************  
```  

With `-f`, **EcoFloc** saves a `.csv` file in the specified path (e.g., `/home/user/`). The filename includes the component and process (e.g., `/ECOFLOC_RAM_PID_20300.csv`).  

If you use `default` (`-f default`), the file goes to the path set in `features.conf` inside the project folder.  

Each row in the `.csv` includes: **PID, average power (Watts), and energy consumed (Joules)**.  

### Example 2: Analyze the Chrome Application  

To monitor **Chrome's GPU usage**, tracking all its PIDs every **1000ms**, running **until you stop it** (`-t -1`), run:  

```bash  
ecofloc --gpu -n chrome -i 1000 -t -1 -d  
```  

The `-d` flag lets **EcoFloc** keep running even if **Chrome** closes and reopens.  

You'll see something like this:  

```console 
/*****************************  
/ECOFLOC_SD_COMM_chrome  
*****************************/  
Average Power (GPU): 1.98 Watts  
Total GPU Energy (GPU): 39.6 Joules  
*****************************  
```  



## <img src="https://github.com/user-attachments/assets/fe776c79-98c7-4741-89b6-047a4868bf5c" width="40"/> References
[^1]: [Têchnopole Domolandes](https://www.domolandes.fr
[^2]: Running Average Power Limit (RAPL): [Intel® 64 and IA-32 Architectures Software Developer's Manual](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html), specifically in the section detailing power and thermal management.
[^3]: Humberto, A.V.H.: An energy-saving perspective for distributed environments:
Deployment, scheduling and simulation with multidimensional entities for Software and Hardware. Ph.D. thesis, UPPA, https://www.theses.fr/s342134 (2022)
